<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amy's Big City Adventure â€” è‹±èªæ•…äº‹å­¸ç¿’</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&family=Baloo+2:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{
  --sky:#5BC8F5; --sun:#FFD93D; --grass:#6BCB77; --coral:#FF6B6B;
  --lavender:#C3A6FF; --peach:#FFB347; --ink:#2D3047; --card:#FFFDF5;
  --shadow:0 4px 20px rgba(45,48,71,.10); --r:20px; --hl:#FFE566; --hlw:#B5F2FF;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Nunito',sans-serif;background:linear-gradient(160deg,#e0f7fa,#fff9e6 50%,#fce4f0);min-height:100vh;color:var(--ink);padding-bottom:60px}

header{background:linear-gradient(135deg,var(--sky),var(--lavender));padding:26px 20px 20px;text-align:center;box-shadow:0 6px 24px rgba(91,200,245,.35)}
header h1{font-family:'Baloo 2',cursive;font-size:clamp(1.4rem,5vw,2.4rem);color:#fff;text-shadow:3px 3px 0 rgba(0,0,0,.15);line-height:1.25}
header p{color:rgba(255,255,255,.9);font-size:.92rem;margin-top:6px;font-weight:700}

.speed-bar{background:#fff;border-radius:var(--r);margin:14px auto;max-width:700px;padding:13px 20px;display:flex;align-items:center;gap:12px;box-shadow:var(--shadow);flex-wrap:wrap}
.speed-bar label{font-weight:800;font-size:.92rem;white-space:nowrap}
#speed-slider{flex:1;min-width:120px;accent-color:var(--sky);cursor:pointer}
#speed-val{font-weight:900;color:var(--coral);font-size:1rem;min-width:40px;text-align:center;background:#fff5f5;border-radius:8px;padding:2px 6px}
.speed-info{font-size:.76rem;color:#888;width:100%}

.wordlist-banner{background:linear-gradient(90deg,var(--sun),var(--peach));border-radius:var(--r);margin:0 auto 16px;max-width:700px;padding:13px 18px;box-shadow:var(--shadow)}
.wordlist-banner h3{font-family:'Baloo 2',cursive;font-size:.98rem;color:var(--ink);margin-bottom:8px}
.word-chips{display:flex;flex-wrap:wrap;gap:6px}
.chip{background:rgba(255,255,255,.75);border-radius:50px;padding:4px 11px;font-size:.8rem;font-weight:700;cursor:pointer;border:2px solid rgba(255,255,255,.9);transition:background .2s,transform .15s;color:var(--ink);user-select:none}
.chip:hover{background:#fff;transform:scale(1.05)}
.chip.on{background:var(--hl)}

.sec-title{text-align:center;font-family:'Baloo 2',cursive;font-size:clamp(1.1rem,4vw,1.8rem);margin:22px 0 11px;color:var(--ink)}
.sec-title span{background:linear-gradient(135deg,var(--coral),var(--lavender));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

.story{max-width:700px;margin:0 auto;padding:0 13px}
.pcard{background:var(--card);border-radius:var(--r);padding:17px 20px;margin-bottom:15px;box-shadow:var(--shadow);border-left:5px solid var(--sky)}
.pcard:nth-child(4n+2){border-left-color:var(--lavender)}
.pcard:nth-child(4n+3){border-left-color:var(--grass)}
.pcard:nth-child(4n+4){border-left-color:var(--coral)}
.pnum{display:inline-block;background:var(--sky);color:#fff;border-radius:50%;width:26px;height:26px;text-align:center;line-height:26px;font-size:.78rem;font-weight:900;margin-bottom:7px}
.para-en{font-size:1rem;line-height:1.95;color:var(--ink)}
.vw{color:#1A6ED8;background:#E8F4FF;border-radius:6px;padding:1px 5px;cursor:pointer;font-weight:800;border-bottom:2px solid #1A6ED8;transition:background .18s,color .18s}
.vw:hover{background:var(--hlw);color:#0A3D8F}
.vw.on{background:var(--hl);color:#7a4000;border-bottom-color:#E8A000}
.ssen.on{background:var(--hl);border-radius:4px}
.para-zh{display:none;margin-top:11px;padding:11px 13px;background:linear-gradient(135deg,#f0fff4,#e8f4ff);border-radius:12px;font-size:.92rem;line-height:1.8;color:#444;border:1px dashed #aaa}

.pctrl{display:flex;gap:8px;margin-top:11px;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 15px;border-radius:50px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-size:.83rem;font-weight:700;box-shadow:0 2px 8px rgba(0,0,0,.12);transition:transform .15s,box-shadow .15s;user-select:none}
.btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.18)}
.btn:active{transform:scale(.97)}
.bzh{background:linear-gradient(135deg,#a8e6cf,#67d7aa);color:#1a5c3a}
.bread{background:linear-gradient(135deg,var(--sky),#3AAFDF);color:#fff}
.bstop{background:linear-gradient(135deg,#ffb347,#ff8000);color:#fff}

.go-quiz{display:block;margin:13px auto 28px;background:linear-gradient(135deg,var(--lavender),#9B59D8);color:#fff;padding:12px 28px;border-radius:50px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-size:1rem;font-weight:800;box-shadow:0 4px 14px rgba(195,166,255,.5);transition:transform .15s;user-select:none}
.go-quiz:hover{transform:scale(1.05)}

.qsec{max-width:700px;margin:8px auto 0;padding:0 13px}
.qintro{background:linear-gradient(135deg,var(--lavender),#e8c5ff);border-radius:var(--r);padding:16px 20px;margin-bottom:16px;text-align:center;box-shadow:var(--shadow)}
.qintro p{font-size:.93rem;font-weight:700;color:var(--ink)}
.qintro p+p{font-size:.8rem;color:#555;margin-top:4px}

.qcard{background:var(--card);border-radius:var(--r);padding:17px 20px;margin-bottom:15px;box-shadow:var(--shadow);border-top:4px solid var(--lavender)}
.qcard.qok{border-top-color:var(--grass)}.qcard.qno{border-top-color:var(--coral)}
.qhdr{display:flex;align-items:flex-start;gap:9px;margin-bottom:11px}
.qnum{background:var(--lavender);color:#fff;border-radius:50%;width:29px;height:29px;min-width:29px;text-align:center;line-height:29px;font-size:.83rem;font-weight:900}
.qtxt{font-size:.97rem;font-weight:700;line-height:1.6;flex:1}
.qtxt.on{background:var(--hl);border-radius:8px;padding:2px 6px}
.qspk{background:none;border:none;cursor:pointer;font-size:1.2rem;padding:2px 4px;border-radius:8px;transition:transform .15s,background .2s;line-height:1;flex-shrink:0}
.qspk:hover{background:#eee;transform:scale(1.15)}
.qspk.on{background:var(--hl)}

.ogrid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:3px}
@media(max-width:480px){.ogrid{grid-template-columns:1fr}}
.obtn{background:#F4F0FF;border:2px solid #D4C8FF;border-radius:12px;padding:9px 13px;text-align:left;cursor:pointer;font-family:'Nunito',sans-serif;font-size:.9rem;font-weight:600;color:var(--ink);transition:background .18s,border-color .18s,transform .12s;user-select:none}
.obtn:hover:not(:disabled){background:#E4D8FF;border-color:#A78BE0;transform:scale(1.02)}
.obtn.sel{background:#D4C8FF;border-color:#7C4DFF;font-weight:800}
.obtn.ok{background:#C8F5D5;border-color:var(--grass);color:#1a5c3a;font-weight:800}
.obtn.no{background:#FFD6D6;border-color:var(--coral);color:#8B1A1A;font-weight:800}
.obtn:disabled{cursor:default}

.qfb{display:none;margin-top:9px;padding:7px 13px;border-radius:10px;font-weight:700;font-size:.87rem}
.fbok{background:#d4edda;color:#155724}.fbno{background:#f8d7da;color:#721c24}

.submit-row{text-align:center;margin:9px 0 22px}
.bsub{background:linear-gradient(135deg,var(--grass),#4CAF50);color:#fff;font-size:1.05rem;padding:13px 36px;border-radius:50px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-weight:800;box-shadow:0 4px 18px rgba(107,203,119,.45);transition:transform .15s,opacity .2s;user-select:none}
.bsub:hover{transform:scale(1.04)}.bsub:disabled{opacity:.5;cursor:default;transform:none}

.scoreboard{display:none;background:linear-gradient(135deg,var(--sun),var(--peach));border-radius:var(--r);padding:24px 20px;margin:16px auto 0;max-width:700px;text-align:center;box-shadow:var(--shadow)}
.scoreboard.show{display:block}
.scoreboard h2{font-family:'Baloo 2',cursive;font-size:1.7rem;color:var(--ink);margin-bottom:8px}
.scorebig{font-family:'Baloo 2',cursive;font-size:3.8rem;color:var(--coral);line-height:1;text-shadow:3px 3px 0 rgba(0,0,0,.1)}
.scoremsg{font-size:.97rem;font-weight:700;color:#555;margin-top:8px}
.bretry{margin-top:15px;background:linear-gradient(135deg,var(--coral),#FF3333);color:#fff;font-size:1rem;padding:11px 26px;border-radius:50px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-weight:800;box-shadow:0 4px 14px rgba(255,107,107,.4);transition:transform .15s;user-select:none}
.bretry:hover{transform:scale(1.05)}
footer{text-align:center;padding:22px;color:#999;font-size:.78rem;margin-top:8px}
footer span{color:var(--coral)}
</style>
</head>
<body>

<header>
  <h1>ğŸŒŸ Amy's Big City Adventure ğŸŒŸ</h1>
  <p>å››å¹´ç´šè‹±èªæ•…äº‹ &amp; é–±è®€æ¸¬é©— ï½œ é»æ“Šè—è‰²å–®å­—å¯ä»¥è½ç™¼éŸ³ ğŸ”Š</p>
</header>

<div class="speed-bar">
  <label for="speed-slider">ğŸ¢ ç™¼éŸ³é€Ÿåº¦</label>
  <input type="range" id="speed-slider" min="0.5" max="1.5" step="0.1" value="0.9">
  <span id="speed-val">0.9Ã—</span>
  <span class="speed-info">å»ºè­°å°æœ‹å‹å¾ 0.7Ã— é–‹å§‹ï¼Œç·´ç†Ÿäº†å†èª¿å¿« ğŸš€</span>
</div>

<div class="wordlist-banner">
  <h3>ğŸ“š æœ¬èª²é‡é»å–®å­— â€” é»ä¸€ä¸‹å°±èƒ½è½ç™¼éŸ³ï¼</h3>
  <div class="word-chips" id="wchips"></div>
</div>

<h2 class="sec-title"><span>ğŸ“– æ•…äº‹é–‹å§‹å›‰ï¼</span></h2>
<div class="story" id="story"></div>

<button class="go-quiz" id="go-quiz-btn">ğŸ§© é–‹å§‹é–±è®€æ¸¬é©—ï¼</button>

<h2 class="sec-title" id="quiz-anchor"><span>ğŸ“ é–±è®€æ¸¬é©— Reading Quiz</span></h2>
<div class="qsec">
  <div class="qintro">
    <p>ğŸ“– æ ¹æ“šæ•…äº‹å›ç­”ä»¥ä¸‹ 10 é¡Œï¼Œæ¯é¡Œé¸ä¸€å€‹æœ€æ­£ç¢ºçš„ç­”æ¡ˆã€‚</p>
    <p>Read the story carefully and choose the best answer for each question.</p>
  </div>
  <div id="qcont"></div>
  <div class="submit-row">
    <button class="bsub" id="sub-btn">ğŸ¯ æäº¤ç­”æ¡ˆ Submit</button>
  </div>
</div>

<div class="scoreboard" id="scoreboard">
  <h2>ğŸ† æ¸¬é©—çµæœ Quiz Result ğŸ†</h2>
  <div class="scorebig" id="scorebig">0 / 10</div>
  <div class="scoremsg" id="scoremsg"></div>
  <button class="bretry" id="retry-btn">ğŸ”„ å†è©¦ä¸€æ¬¡ Try Again</button>
</div>

<footer><p>âœ¨ è¨­è¨ˆçµ¦åŠªåŠ›å­¸ç¿’è‹±èªçš„å°æœ‹å‹ âœ¨ ï½œ <span>Amy's Big City Adventure</span> Â© 2025</p></footer>

<script>
/* =========================================================
   DATA
   ========================================================= */
var VOCAB = [
  ["bookstore","æ›¸åº—"],["restaurant","é¤å»³"],["hospital","é†«é™¢"],
  ["bakery","éºµåŒ…åº—"],["bank","éŠ€è¡Œ"],["post office","éƒµå±€"],
  ["post","éƒµæ”¿/éƒµä»¶"],["office","è¾¦å…¬å®¤"],["bike","è…³è¸è»Š"],
  ["scooter","æ©Ÿè»Š"],["taxi","è¨ˆç¨‹è»Š"],["bus","å…¬è»Š"],
  ["train","ç«è»Š"],["car","æ±½è»Š"],["MRT","æ·é‹"],["plane","é£›æ©Ÿ"],
  ["dress","æ´‹è£"],["skirt","è£™å­"],["T-shirt","Tæ¤"],["shorts","çŸ­è¤²"],
  ["sneakers","é‹å‹•é‹"],["pants","è¤²å­/é•·è¤²"],["sweater","æ¯›è¡£"],
  ["jacket","å¤¾å…‹/å¤–å¥—"],["smartphone","æ™ºæ…§å‹æ‰‹æ©Ÿ"],["phone","é›»è©±/æ‰‹æ©Ÿ"],
  ["smart","è°æ˜çš„"],["umbrella","é›¨å‚˜"],["water bottle","æ°´å£º/æ°´ç“¶"],
  ["glasses","çœ¼é¡"],["glass","ç»ç’ƒæ¯"]
];
// sort longest first so "post office" matched before "post", "water bottle" before "water", "glasses" before "glass", "smartphone" before "phone", "T-shirt" before "shirt"
VOCAB.sort(function(a,b){ return b[0].length - a[0].length; });

var PARAS = [
  {
    en:"One Saturday morning, Amy put on her favorite dress â€” a bright yellow one â€” and grabbed her water bottle and umbrella. She also wore her sneakers and glasses. \"Today is a big adventure day!\" she said with a big smile.",
    zh:"ä¸€å€‹æ˜ŸæœŸå…­çš„æ—©ä¸Šï¼Œè‰¾å’ªç©¿ä¸Šå¥¹æœ€å–œæ­¡çš„æ´‹è£â€”â€”ä¸€ä»¶äº®é»ƒè‰²çš„â€”â€”ç„¶å¾Œæ‹¿èµ·å¥¹çš„æ°´å£ºå’Œé›¨å‚˜ã€‚å¥¹é‚„ç©¿ä¸Šäº†é‹å‹•é‹ï¼Œæˆ´ä¸Šçœ¼é¡ã€‚ã€Œä»Šå¤©æ˜¯å¤§å†’éšªæ—¥ï¼ã€å¥¹å¸¶è‘—å¤§å¤§çš„å¾®ç¬‘èªªé“ã€‚"
  },
  {
    en:"Amy's mom said, \"We need to take the bus downtown. Later we can ride the MRT to the other side of the city.\" Amy nodded and picked up her smartphone to check the map. She was such a smart girl â€” she already knew which stop to get off at!",
    zh:"è‰¾å’ªçš„åª½åª½èªªï¼šã€Œæˆ‘å€‘éœ€è¦æ­å…¬è»Šå»å¸‚å€ã€‚ä¹‹å¾Œæˆ‘å€‘å¯ä»¥æ­æ·é‹åˆ°åŸå¸‚çš„å¦ä¸€é‚Šã€‚ã€è‰¾å’ªé»é»é ­ï¼Œæ‹¿èµ·å¥¹çš„æ™ºæ…§å‹æ‰‹æ©ŸæŸ¥çœ‹åœ°åœ–ã€‚å¥¹çœŸæ˜¯å€‹è°æ˜çš„å¥³å­©â€”â€”å¥¹å·²ç¶“çŸ¥é“è¦åœ¨å“ªä¸€ç«™ä¸‹è»Šäº†ï¼"
  },
  {
    en:"Their first stop was the bakery near the post office. Mom had to send a package at the post office â€” she said the post was very important for work in her office. While Mom stood in line, Amy enjoyed the sweet smell of fresh bread from the bakery next door.",
    zh:"å¥¹å€‘çš„ç¬¬ä¸€ç«™æ˜¯éƒµå±€æ—é‚Šçš„éºµåŒ…åº—ã€‚åª½åª½éœ€è¦åœ¨éƒµå±€å¯„ä¸€å€‹åŒ…è£¹â€”â€”å¥¹èªªéƒµä»¶å°å¥¹åœ¨è¾¦å…¬å®¤çš„å·¥ä½œéå¸¸é‡è¦ã€‚åª½åª½åœ¨æ’éšŠçš„æ™‚å€™ï¼Œè‰¾å’ªäº«å—è‘—éš”å£éºµåŒ…åº—é£„ä¾†çš„æ–°é®®éºµåŒ…é¦™æ°£ã€‚"
  },
  {
    en:"Next, they walked to the bank so Mom could take out some money. A taxi almost splashed a puddle on Amy as it rushed past! Luckily, she jumped back just in time â€” her sneakers stayed dry. Nearby, a man on a scooter was delivering packages, and a girl on a bike rode by with a wave.",
    zh:"æ¥è‘—ï¼Œå¥¹å€‘èµ°å»éŠ€è¡Œè®“åª½åª½é ˜ä¸€äº›éŒ¢ã€‚ä¸€è¼›è¨ˆç¨‹è»Šå‘¼å˜¯è€Œéï¼Œå·®é»æŠŠæ°´æ¿ºåœ¨è‰¾å’ªèº«ä¸Šï¼å¹¸å¥½å¥¹åŠæ™‚è·³é–‹â€”â€”å¥¹çš„é‹å‹•é‹ä¿æŒä¹¾ç‡¥ã€‚é™„è¿‘ï¼Œä¸€å€‹é¨è‘—æ©Ÿè»Šçš„ç”·äººæ­£åœ¨é€åŒ…è£¹ï¼Œä¸€å€‹é¨è…³è¸è»Šçš„å¥³å­©æ®æ‰‹ç¶“éã€‚"
  },
  {
    en:"After the bank, Amy and Mom ate lunch at a lovely restaurant near the MRT station. Amy ordered noodle soup and drank a glass of orange juice â€” she loved the tall glass it came in! \"This restaurant has such good food,\" said Amy, slurping happily.",
    zh:"åœ¨éŠ€è¡Œä¹‹å¾Œï¼Œè‰¾å’ªå’Œåª½åª½åœ¨æ·é‹ç«™é™„è¿‘ä¸€å®¶å¯æ„›çš„é¤å»³åƒåˆé¤ã€‚è‰¾å’ªé»äº†æ¹¯éºµï¼Œä¸¦å–äº†ä¸€æ¯æŸ³æ©™æ±â€”â€”å¥¹å¥½å–œæ­¡é‚£å€‹é«˜é«˜çš„ç»ç’ƒæ¯ï¼ã€Œé€™å®¶é¤å»³çš„é£Ÿç‰©çœŸçš„å¥½å¥½åƒï¼Œã€è‰¾å’ªé–‹å¿ƒåœ°å¸è‘—éºµèªªã€‚"
  },
  {
    en:"In the afternoon, they took the train to a shopping district. Amy wanted to buy new clothes! She found a cute pink skirt, a cozy sweater, and a cool jacket. Her little brother back home had asked for a new T-shirt and some shorts, so she picked those up too. Mom also bought pants for Dad.",
    zh:"ä¸‹åˆï¼Œå¥¹å€‘æ­ç«è»Šå»è³¼ç‰©å€ã€‚è‰¾å’ªæƒ³è²·æ–°è¡£æœï¼å¥¹æ‰¾åˆ°äº†ä¸€æ¢å¯æ„›çš„ç²‰ç´…è‰²è£™å­ã€ä¸€ä»¶èˆ’é©çš„æ¯›è¡£ï¼Œå’Œä¸€ä»¶å¸¥æ°£çš„å¤¾å…‹ã€‚åœ¨å®¶çš„å¼Ÿå¼Ÿè¦å¥¹å¹«è²·ä¸€ä»¶æ–°çš„Tæ¤å’Œä¸€æ¢çŸ­è¤²ï¼Œæ‰€ä»¥å¥¹ä¹Ÿä¸€èµ·è²·äº†ã€‚åª½åª½ä¹Ÿå¹«çˆ¸çˆ¸è²·äº†é•·è¤²ã€‚"
  },
  {
    en:"After shopping, they passed a wonderful bookstore. Amy's eyes lit up! She ran in and found a book about planes and trains and how people travel the world. \"I want to ride every kind of transport someday â€” plane, train, bus, and even a car through the mountains!\" she said to the phone camera as she took a selfie with the book.",
    zh:"è³¼ç‰©ä¹‹å¾Œï¼Œå¥¹å€‘ç¶“éäº†ä¸€å®¶ç¾å¦™çš„æ›¸åº—ã€‚è‰¾å’ªçš„çœ¼ç›äº®äº†èµ·ä¾†ï¼å¥¹è·‘é€²å»ï¼Œæ‰¾åˆ°äº†ä¸€æœ¬é—œæ–¼é£›æ©Ÿå’Œç«è»Šï¼Œä»¥åŠäººå€‘å¦‚ä½•ç’°éŠä¸–ç•Œçš„æ›¸ã€‚ã€Œæˆ‘æœ‰ä¸€å¤©æƒ³è¦é«”é©—å„ç¨®äº¤é€šå·¥å…·â€”â€”é£›æ©Ÿã€ç«è»Šã€å…¬è»Šï¼Œç”šè‡³æ˜¯é–‹è‘—æ±½è»Šç©¿è¶Šå±±è„ˆï¼ã€å¥¹å°è‘—æ‰‹æ©Ÿé¡é ­èªªï¼ŒåŒæ™‚æ‹¿è‘—æ›¸è‡ªæ‹ã€‚"
  },
  {
    en:"On the way home, it started to rain. Amy opened her umbrella proudly â€” she was glad she had brought it! Mom called a taxi on her phone because the bags were too heavy to carry on the bus. They rode home comfortably as the rain tapped on the car windows.",
    zh:"å›å®¶çš„è·¯ä¸Šï¼Œé–‹å§‹ä¸‹é›¨äº†ã€‚è‰¾å’ªé©•å‚²åœ°æ’é–‹å¥¹çš„é›¨å‚˜â€”â€”å¥¹å¥½æ…¶å¹¸å¸¶ä¾†äº†ï¼åª½åª½ç”¨æ‰‹æ©Ÿå«äº†ä¸€è¼›è¨ˆç¨‹è»Šï¼Œå› ç‚ºè¢‹å­å¤ªé‡äº†ï¼Œä¸æ–¹ä¾¿æ­å…¬è»Šã€‚é›¨æ°´è¼•è¼•æ•²æ‰“è‘—æ±½è»Šçš„çª—æˆ¶ï¼Œå¥¹å€‘èˆ’èˆ’æœæœåœ°æ­è»Šå›å®¶ã€‚"
  },
  {
    en:"That night, Amy found out Mom had a fun surprise â€” they would fly on a plane next month to visit Grandma! Amy hugged her new book tightly and whispered, \"I can't wait to visit the hospital where Grandma works as a nurse, and explore more of the city!\" It had truly been an amazing day.",
    zh:"é‚£å¤©æ™šä¸Šï¼Œè‰¾å’ªç™¼ç¾åª½åª½æœ‰å€‹æœ‰è¶£çš„é©šå–œâ€”â€”ä¸‹å€‹æœˆå¥¹å€‘è¦æ­é£›æ©Ÿå»æ¢æœ›å¥¶å¥¶ï¼è‰¾å’ªç·Šç·ŠæŠ±è‘—å¥¹çš„æ–°æ›¸ï¼Œè¼•è²èªªï¼šã€Œæˆ‘ç­‰ä¸åŠè¦å»æ¢æœ›åœ¨é†«é™¢ç•¶è­·å£«çš„å¥¶å¥¶ï¼Œé‚„æœ‰æ¢ç´¢æ›´å¤šé€™å€‹åŸå¸‚ï¼ã€é€™çœŸçš„æ˜¯ç¾å¥½çš„ä¸€å¤©ã€‚"
  }
];

var QUESTIONS = [
  {q:"What was Amy wearing on her adventure day?",
   opts:["A. A blue jacket and pants","B. A yellow dress, sneakers, and glasses","C. A skirt and a sweater","D. A T-shirt and shorts"],ans:"B"},
  {q:"How did Amy and her mom travel downtown first?",
   opts:["A. By taxi","B. By plane","C. By bus","D. By scooter"],ans:"C"},
  {q:"Why did Amy's mom go to the post office?",
   opts:["A. To buy stamps","B. To send a package","C. To pick up mail","D. To pay her phone bill"],ans:"B"},
  {q:"What almost happened to Amy near the bank?",
   opts:["A. She dropped her water bottle","B. She lost her glasses","C. A taxi almost splashed a puddle on her","D. A bike rider knocked her over"],ans:"C"},
  {q:"What did Amy eat for lunch at the restaurant?",
   opts:["A. Pizza and milk","B. Noodle soup and orange juice","C. Bread and water","D. Rice and tea"],ans:"B"},
  {q:"Which clothing items did Amy's brother ask her to buy?",
   opts:["A. A dress and sneakers","B. A jacket and sweater","C. A T-shirt and shorts","D. Pants and a skirt"],ans:"C"},
  {q:"What kind of book did Amy find in the bookstore?",
   opts:["A. A book about cooking","B. A book about planes, trains, and world travel","C. A book about animals","D. A book about smartphones"],ans:"B"},
  {q:"Why did Amy and her mom take a taxi home instead of the bus?",
   opts:["A. The bus was too slow","B. It was too hot outside","C. The bags were too heavy to carry on the bus","D. The bus station was closed"],ans:"C"},
  {q:"Where does Amy's grandma work?",
   opts:["A. At a restaurant","B. At a bookstore","C. At a bank","D. At a hospital"],ans:"D"},
  {q:"What is the best title for this story?",
   opts:["A. Amy Stays Home All Day","B. Amy's Big City Adventure","C. Amy Goes to School","D. Amy Rides a Plane"],ans:"B"}
];

/* =========================================================
   STATE
   ========================================================= */
var rate = 0.9;
var answers = {};
var submitted = false;
var activeReadBtn = null;

/* =========================================================
   SPEECH
   ========================================================= */
function stopAll() {
  try { window.speechSynthesis.cancel(); } catch(e){}
  var els;
  els = document.getElementsByClassName("on");
  while(els.length){ els[0].classList.remove("on"); }
  if(activeReadBtn){
    activeReadBtn.textContent = "ğŸ”Š æœ—è®€æ•…äº‹";
    activeReadBtn.className = "btn bread";
    activeReadBtn = null;
  }
}

function doSpeak(text, onDone) {
  if(!window.speechSynthesis){ if(onDone) onDone(); return null; }
  var u = new SpeechSynthesisUtterance(text);
  u.lang = "en-US";
  u.rate = rate;
  u.onend = function(){ if(onDone) onDone(); };
  u.onerror = function(){ if(onDone) onDone(); };
  window.speechSynthesis.speak(u);
  return u;
}

function speakWithHL(text, spans, onDone) {
  if(!window.speechSynthesis){ if(onDone) onDone(); return; }
  var u = new SpeechSynthesisUtterance(text);
  u.lang = "en-US";
  u.rate = rate;
  // build char offsets
  var offs = [];
  var c = 0;
  for(var i=0;i<spans.length;i++){
    offs.push(c);
    c += spans[i].textContent.length + 1;
  }
  var last = -1;
  u.onboundary = function(e){
    var ci = e.charIndex;
    var idx = 0;
    for(var i=0;i<offs.length;i++){ if(offs[i]<=ci) idx=i; }
    if(idx!==last){
      if(last>=0 && spans[last]) spans[last].classList.remove("on");
      if(spans[idx]) spans[idx].classList.add("on");
      last = idx;
    }
  };
  u.onend = function(){
    for(var i=0;i<spans.length;i++) if(spans[i]) spans[i].classList.remove("on");
    if(onDone) onDone();
  };
  u.onerror = function(){
    for(var i=0;i<spans.length;i++) if(spans[i]) spans[i].classList.remove("on");
    if(onDone) onDone();
  };
  window.speechSynthesis.speak(u);
}

/* =========================================================
   VOCAB PARSER  (char-by-char, no regex)
   ========================================================= */
function isWordChar(ch) {
  if(!ch) return false;
  var c = ch.toLowerCase();
  return (c>='a' && c<='z') || c==='-';
}

// Returns [{type:"t",v:string} | {type:"w",v:string,word:string}]
function parseText(text) {
  var parts = [];
  var i = 0;
  var tlen = text.length;
  while(i < tlen){
    var matched = false;
    for(var vi=0; vi<VOCAB.length; vi++){
      var vw = VOCAB[vi][0];
      var vlen = vw.length;
      // check match at position i (case-insensitive)
      if(i + vlen > tlen) continue;
      var seg = text.slice(i, i+vlen);
      if(seg.toLowerCase() !== vw.toLowerCase()) continue;
      // check word boundaries
      var before = i>0 ? text[i-1] : '';
      var after  = (i+vlen < tlen) ? text[i+vlen] : '';
      if(isWordChar(before)) continue;
      if(isWordChar(after))  continue;
      // matched!
      parts.push({type:"w", v:seg, word:vw});
      i += vlen;
      matched = true;
      break;
    }
    if(!matched){
      if(parts.length && parts[parts.length-1].type==="t"){
        parts[parts.length-1].v += text[i];
      } else {
        parts.push({type:"t", v:text[i]});
      }
      i++;
    }
  }
  return parts;
}

function buildEnEl(text, paraIdx) {
  var p = document.createElement("p");
  p.className = "para-en";
  p.id = "en"+paraIdx;
  var parts = parseText(text);
  for(var i=0;i<parts.length;i++){
    var pt = parts[i];
    if(pt.type==="t"){
      p.appendChild(document.createTextNode(pt.v));
    } else {
      (function(sp, word){
        sp.className = "vw";
        var zhArr = [];
        for(var vi=0;vi<VOCAB.length;vi++) if(VOCAB[vi][0].toLowerCase()===word.toLowerCase()){ zhArr.push(VOCAB[vi][1]); break; }
        sp.title = word + " = " + (zhArr[0]||"");
        sp.addEventListener("click", function(e){
          e.stopPropagation();
          stopAll();
          sp.classList.add("on");
          doSpeak(word, function(){ sp.classList.remove("on"); });
        });
        p.appendChild(sp);
      })(document.createElement("span"), pt.word);
    }
  }
  return p;
}

/* =========================================================
   BUILD STORY
   ========================================================= */
function buildStory() {
  var cont = document.getElementById("story");
  cont.innerHTML = "";
  for(var pi=0; pi<PARAS.length; pi++){
    var card = document.createElement("div");
    card.className = "pcard";

    var num = document.createElement("span");
    num.className = "pnum";
    num.textContent = (pi+1);
    card.appendChild(num);

    var enP = buildEnEl(PARAS[pi].en, pi);
    card.appendChild(enP);

    var zhP = document.createElement("div");
    zhP.className = "para-zh";
    zhP.id = "zh"+pi;
    zhP.textContent = PARAS[pi].zh;
    card.appendChild(zhP);

    var ctrl = document.createElement("div");
    ctrl.className = "pctrl";

    // Chinese toggle button
    (function(idx, zhDiv){
      var bz = document.createElement("button");
      bz.className = "btn bzh";
      bz.textContent = "ğŸ”¤ é¡¯ç¤ºä¸­æ–‡";
      bz.addEventListener("click", function(){
        if(zhDiv.style.display === "block"){
          zhDiv.style.display = "none";
          bz.textContent = "ğŸ”¤ é¡¯ç¤ºä¸­æ–‡";
        } else {
          zhDiv.style.display = "block";
          bz.textContent = "ğŸ”¤ éš±è—ä¸­æ–‡";
        }
      });
      ctrl.appendChild(bz);
    })(pi, zhP);

    // Read aloud button
    (function(idx, enEl){
      var br = document.createElement("button");
      br.className = "btn bread";
      br.textContent = "ğŸ”Š æœ—è®€æ•…äº‹";
      br.addEventListener("click", function(){
        if(activeReadBtn === br){
          stopAll();
          return;
        }
        stopAll();
        activeReadBtn = br;
        br.textContent = "â¹ åœæ­¢æœ—è®€";
        br.className = "btn bstop";
        var spans = enEl.querySelectorAll(".ssen");
        if(spans.length === 0){
          // Wrap sentences in spans for highlighting
          var text = PARAS[idx].en;
          doSpeak(text, function(){
            br.textContent = "ğŸ”Š æœ—è®€æ•…äº‹";
            br.className = "btn bread";
            activeReadBtn = null;
          });
        } else {
          speakWithHL(PARAS[idx].en, Array.prototype.slice.call(spans), function(){
            br.textContent = "ğŸ”Š æœ—è®€æ•…äº‹";
            br.className = "btn bread";
            activeReadBtn = null;
          });
        }
      });
      ctrl.appendChild(br);
    })(pi, enP);

    card.appendChild(ctrl);
    cont.appendChild(card);
  }
}

/* =========================================================
   BUILD WORD CHIPS
   ========================================================= */
function buildChips() {
  var cont = document.getElementById("wchips");
  cont.innerHTML = "";
  for(var i=0; i<VOCAB.length; i++){
    (function(word, zh){
      var chip = document.createElement("span");
      chip.className = "chip";
      chip.textContent = word + " " + zh;
      chip.title = word + " = " + zh;
      chip.addEventListener("click", function(){
        stopAll();
        chip.classList.add("on");
        doSpeak(word, function(){ chip.classList.remove("on"); });
      });
      cont.appendChild(chip);
    })(VOCAB[i][0], VOCAB[i][1]);
  }
}

/* =========================================================
   BUILD QUIZ
   ========================================================= */
function buildQuiz() {
  var cont = document.getElementById("qcont");
  cont.innerHTML = "";
  answers = {};
  submitted = false;
  document.getElementById("sub-btn").disabled = false;
  document.getElementById("scoreboard").classList.remove("show");

  for(var qi=0; qi<QUESTIONS.length; qi++){
    var q = QUESTIONS[qi];
    var card = document.createElement("div");
    card.className = "qcard";
    card.id = "qcard"+qi;

    var hdr = document.createElement("div");
    hdr.className = "qhdr";

    var qnum = document.createElement("span");
    qnum.className = "qnum";
    qnum.textContent = (qi+1);
    hdr.appendChild(qnum);

    var qtxt = document.createElement("span");
    qtxt.className = "qtxt";
    qtxt.id = "qtxt"+qi;
    qtxt.textContent = q.q;
    hdr.appendChild(qtxt);

    var spkBtn = document.createElement("button");
    spkBtn.className = "qspk";
    spkBtn.textContent = "ğŸ”Š";
    spkBtn.title = "è½é¡Œç›®";
    (function(text, btn, txt){
      btn.addEventListener("click", function(){
        stopAll();
        btn.classList.add("on");
        txt.classList.add("on");
        doSpeak(text, function(){
          btn.classList.remove("on");
          txt.classList.remove("on");
        });
      });
    })(q.q, spkBtn, qtxt);
    hdr.appendChild(spkBtn);

    card.appendChild(hdr);

    var grid = document.createElement("div");
    grid.className = "ogrid";

    for(var oi=0; oi<q.opts.length; oi++){
      (function(qIdx, optIdx, optText, letter){
        var ob = document.createElement("button");
        ob.className = "obtn";
        ob.textContent = optText;
        ob.addEventListener("click", function(){
          if(submitted) return;
          // deselect others in same question
          var siblings = grid.querySelectorAll(".obtn");
          for(var s=0; s<siblings.length; s++) siblings[s].classList.remove("sel");
          ob.classList.add("sel");
          answers[qIdx] = letter;
        });
        grid.appendChild(ob);
      })(qi, oi, q.opts[oi], String.fromCharCode(65+oi));
    }

    card.appendChild(grid);

    var fb = document.createElement("div");
    fb.className = "qfb";
    fb.id = "qfb"+qi;
    card.appendChild(fb);

    cont.appendChild(card);
  }
}

/* =========================================================
   SUBMIT QUIZ
   ========================================================= */
function submitQuiz() {
  if(submitted) return;

  // Check all answered
  var total = QUESTIONS.length;
  var answered = Object.keys(answers).length;
  if(answered < total){
    alert("è«‹å…ˆå›ç­”æ‰€æœ‰ " + total + " é¡Œå–”ï¼\nPlease answer all " + total + " questions first!");
    return;
  }

  submitted = true;
  document.getElementById("sub-btn").disabled = true;

  var score = 0;
  for(var qi=0; qi<QUESTIONS.length; qi++){
    var q = QUESTIONS[qi];
    var card = document.getElementById("qcard"+qi);
    var fb = document.getElementById("qfb"+qi);
    var userAns = answers[qi];
    var correct = q.ans;
    var isCorrect = (userAns === correct);

    if(isCorrect){
      score++;
      card.classList.add("qok");
      fb.className = "qfb fbok";
      fb.textContent = "âœ… æ­£ç¢ºï¼Great job!";
    } else {
      card.classList.add("qno");
      fb.className = "qfb fbno";
      var correctIdx = correct.charCodeAt(0) - 65;
      fb.textContent = "âŒ æ­£ç¢ºç­”æ¡ˆæ˜¯ " + q.opts[correctIdx];
    }
    fb.style.display = "block";

    // Highlight correct/wrong options
    var btns = card.querySelectorAll(".obtn");
    for(var bi=0; bi<btns.length; bi++){
      btns[bi].disabled = true;
      var letter = String.fromCharCode(65+bi);
      if(letter === correct){
        btns[bi].classList.add("ok");
      } else if(letter === userAns && !isCorrect){
        btns[bi].classList.add("no");
      }
    }
  }

  // Show scoreboard
  var sb = document.getElementById("scoreboard");
  document.getElementById("scorebig").textContent = score + " / " + total;
  var msg = "";
  if(score === total) msg = "ğŸ‰ æ»¿åˆ†ï¼ä½ å¤ªå²å®³äº†ï¼Perfect score!";
  else if(score >= 8) msg = "ğŸ‘ éå¸¸æ£’ï¼Almost perfect!";
  else if(score >= 6) msg = "ğŸ˜Š ä¸éŒ¯å–”ï¼Good job!";
  else if(score >= 4) msg = "ğŸ’ª åŠ æ²¹ï¼å†è®€ä¸€æ¬¡æ•…äº‹è©¦è©¦ï¼Keep trying!";
  else msg = "ğŸ“– å†ä»”ç´°è®€ä¸€æ¬¡æ•…äº‹å§ï¼Read the story again!";
  document.getElementById("scoremsg").textContent = msg;
  sb.classList.add("show");
  sb.scrollIntoView({behavior:"smooth", block:"center"});
}

/* =========================================================
   INIT
   ========================================================= */
document.addEventListener("DOMContentLoaded", function(){
  // Speed slider
  var slider = document.getElementById("speed-slider");
  var sval = document.getElementById("speed-val");
  slider.addEventListener("input", function(){
    rate = parseFloat(slider.value);
    sval.textContent = rate.toFixed(1) + "Ã—";
  });

  // Build everything
  buildChips();
  buildStory();
  buildQuiz();

  // Go to quiz button
  document.getElementById("go-quiz-btn").addEventListener("click", function(){
    document.getElementById("quiz-anchor").scrollIntoView({behavior:"smooth"});
  });

  // Submit button
  document.getElementById("sub-btn").addEventListener("click", submitQuiz);

  // Retry button
  document.getElementById("retry-btn").addEventListener("click", function(){
    buildQuiz();
    document.getElementById("quiz-anchor").scrollIntoView({behavior:"smooth"});
  });
});
</script>
</body>
</html>